{%- assign color_option_index = nil -%}
{%- for option in banner_product.options_with_values -%}
  {%- assign opt_name = option.name | downcase -%}
  {%- if opt_name contains 'color' or opt_name contains 'colour' or opt_name contains 'цвет' -%}
    {%- assign color_option_index = forloop.index0 -%}
    {%- break -%}
  {%- endif -%}
{%- endfor -%}

{%- if color_option_index != nil -%}
  {%- assign unique_colors = banner_product.variants | map: 'option1' | uniq -%}
  {%- assign images_per_color = 5 -%}

  <div class="banner-product__colors">
    {%- for color in unique_colors -%}
      {%- assign color_variant = banner_product.variants | where: 'option1', color | first -%}
      {%- if color_variant -%}
        {%- assign color_index = forloop.index0 -%}
        {%- assign start_index = color_index | times: images_per_color -%}
        {%- assign end_index = start_index | plus: images_per_color | minus: 1 -%}
        {%- assign color_image = color_variant.image | default: banner_product.featured_image -%}

        <button 
          type="button"
          class="banner-product__color-btn"
          data-start="{{ start_index }}"
          data-end="{{ end_index }}"
          data-price="{{ color_variant.price | money }}"
          data-compare="{{ color_variant.compare_at_price | money }}"
          data-available="{{ color_variant.available }}"
          data-qty="{{ color_variant.inventory_quantity }}"
          data-color="{{ color }}"
        >
          <img 
            src="{{ color_image | image_url: width: 60 }}" 
            alt="{{ color }}"
            width="60"
            height="60"
          >
        </button>
      {%- endif -%}
    {%- endfor -%}
  </div>

  <div 
    class="banner-product__stock"
    data-not-available="{{ 'products.product.banner.not_available' | t: default: 'Not available' }}"
    data-available-template="{{ 'products.product.banner.available_with_count' | t: count: '__COUNT__', default: 'Available: __COUNT__' }}"
  >
    {{ 'products.product.banner.select_color' | t: default: 'Choose a color' }}
  </div>
{%- endif -%}
