{{ 'section-featured-products.css' | asset_url | stylesheet_tag }}
<script src='{{ 'featured-products.js' | asset_url }}' defer></script>

<section
  class='featured-products'
  data-featured-products
  data-section-id='{{ section.id }}'
>
  {% if section.settings.heading %}
    <h2 class='featured-products__title'>{{ section.settings.heading }}</h2>
  {% endif %}

  <div class='featured-products__controls'>
    <label for='sort-by-{{ section.id }}' class='featured-products__label'
      >Sort by:</label
    >
    <select id='sort-by-{{ section.id }}' class='featured-products__select'>
      <option value='best-selling'>Best Selling</option>
      <option value='price-low'>Price: Low to High</option>
      <option value='price-high'>Price: High to Low</option>
      <option value='title-ascending'>Alphabetically, A–Z</option>
    </select>
  </div>

  <div
    id='featured-products-grid-{{ section.id }}'
    class='featured-products__grid'
  >
    {% assign collection = collections[section.settings.collection] %}

    {% if collection.products_count > 0 %}
      {% assign limit = section.settings.products_count %}

      {% for product in collection.products limit: limit %}
        <article
          class='featured-products__item product-card'
          data-product-id='{{ product.id }}'
          data-price='{{ product.price }}'
          data-title='{{ product.title | escape }}'
        >
          <a href='{{ product.url }}' class='product-card__link'>
            {% if product.featured_image %}
              {% assign alt_text = 'Featured product — '
                | append: product.title
              %}
              {{
                product.featured_image
                | image_url: width: 400
                | image_tag:
                  alt: alt_text,
                  class: 'product-card__image',
                  loading: 'lazy'
              }}
            {% else %}
              {{
                'product-placeholder.jpg'
                | asset_img_url: '400x'
                | image_tag:
                  alt: product.title,
                  class: 'product-card__image product-card__image--placeholder',
                  loading: 'lazy'
              }}
            {% endif %}

            <h3 class='product-card__title'>{{ product.title }}</h3>
          </a>

          {% if section.settings.show_price %}
            <p class='product-card__price'>
              {% if product.compare_at_price > product.price %}
                <span class='product-card__price--sale'>
                  {{- product.price | money -}}
                </span>
                <span class='product-card__price--compare'>
                  {{- product.compare_at_price | money -}}
                </span>
              {% else %}
                {{ product.price | money }}
              {% endif %}
            </p>
          {% endif %}

          {% if section.settings.show_rating %}
            <div class='product-card__rating'>
              <img
                src='{{ 'icon-stars.svg' | asset_url }}'
                alt='Star'
                width='16'
                height='16'
                loading='lazy'
                class='product-card__rating-icon'
              >
              <span class='product-card__rating-value'>
                {{ product.metafields.reviews.rating.value | default: 4.5 }}
              </span>
            </div>
          {% endif %}

          {% if section.settings.show_add_to_cart %}
            {% if product.available %}
              <button
                class='product-card__button'
                data-variant-id='{{ product.variants.first.id }}'
                type='button'
              >
                Add to cart
              </button>
            {% else %}
              <button
                class='product-card__button product-card__button--sold-out'
                disabled
              >
                Sold out
              </button>
            {% endif %}
          {% endif %}
        </article>
      {% endfor %}

    {% else %}
      <p class='featured-products__empty'>No products found.</p>
    {% endif %}
  </div>
</section>

{% schema %}
{
  "name": "Featured Products",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Featured Products"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "range",
      "id": "products_count",
      "label": "Number of products",
      "min": 2,
      "max": 12,
      "step": 1,
      "default": 6
    },
    {
      "type": "checkbox",
      "id": "show_price",
      "label": "Show product price",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_rating",
      "label": "Show product rating",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_add_to_cart",
      "label": "Show Add to Cart button",
      "default": true
    }
  ],
  "presets": [
    {
      "name": "Featured Products",
      "category": "Custom sections"
    }
  ]
}
{% endschema %}
